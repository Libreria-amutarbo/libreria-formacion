<div class="dcx-datepicker">
  <div
    class="dcx-datepicker__input-wrapper"
    [class.dcx-datepicker__input-wrapper--disabled]="disabled()"
    [class.dcx-datepicker__input-wrapper--open]="isOpen()"
    (click)="toggleCalendar()"
    tabindex="0"
    role="button"
  >
    <dcx-ng-input
      class="dcx-datepicker__input"
      [label]="''"
      [placeholder]="placeholder() || 'dd/mm/yyyy'"
      [disabled]="disabled()"
      [required]="false"
      [type]="DcxInputType.TEXT"
      [value]="formattedSelectedDate()"
      [readonly]="true"
      (valueChange)="null"
    ></dcx-ng-input>

    @if (selectedDate() && !disabled()) {
      <dcx-ng-button
        class="dcx-datepicker__clear"
        [icon]="true"
        iconName="x-lg"
        ariaLabel="Limpiar fecha"
        (buttonClick)="clearDate($event)"
      ></dcx-ng-button>
    }
  </div>

  @if (isOpen()) {
    <div class="dcx-datepicker__calendar">
      <div class="dcx-datepicker__header">
        <dcx-ng-button
          class="dcx-datepicker__nav-button"
          [icon]="true"
          iconPosition="left"
          iconName="arrow-left"
          ariaLabel="Anterior"
          (buttonClick)="previousMonth()"
        ></dcx-ng-button>

        @if (isCalendarMode()) {
          <span
            class="dcx-datepicker__month-name"
            (click)="openMonthSelector()"
            style="cursor:pointer;"
            tabindex="0"
            role="button"
          >
            {{ monthName() }}
          </span>
          <span
            class="dcx-datepicker__month-name"
            (click)="openYearSelector()"
            style="cursor:pointer; margin-left: 8px;"
            tabindex="0"
            role="button"
          >
            {{ yearNumber() }}
          </span>
        }
        @if (isMonthMode()) {
          <span class="dcx-datepicker__month-name">Selecciona mes</span>
        }
        @if (isYearMode()) {
          <span class="dcx-datepicker__month-name">Selecciona a√±o</span>
        }

        <dcx-ng-button
          class="dcx-datepicker__nav-button"
          [icon]="true"
          iconPosition="right"
          iconName="arrow-right"
          ariaLabel="Siguiente"
          (buttonClick)="nextMonth()"
        ></dcx-ng-button>
      </div>

      @if (isCalendarMode()) {
        <div class="dcx-datepicker__weekdays">
          @for (day of weekDays; track day) {
            <span class="dcx-datepicker__weekday">{{ day }}</span>
          }
        </div>
        <div class="dcx-datepicker__days">
          @for (day of calendarDays(); track day.date.getTime()) {
            <dcx-ng-button
              class="dcx-datepicker__day"
              variant="secondary"
              [ngClass]="{
                                    'dcx-datepicker__day--other-month': !day.isCurrentMonth,
                                    'dcx-datepicker__day--today': day.isToday,
                                    'dcx-datepicker__day--selected': day.isSelected,
                                    'dcx-datepicker__day--disabled': day.isDisabled
                                }"
              [label]="day.date.getDate().toString()"
              [disabled]="day.isDisabled"
              (buttonClick)="selectDate(day)"
            >
            </dcx-ng-button>
          }
        </div>
      }
      @if (isMonthMode()) {
        <div class="dcx-datepicker__months-grid">
          @for (month of monthsList; track month) {
            <dcx-ng-button
              class="dcx-datepicker__day"
              [label]="month.toString()"
              (buttonClick)="selectMonth($index)"
            >
            </dcx-ng-button>
          }
        </div>
      }
      @if (isYearMode()) {
        <div class="dcx-datepicker__years-grid">
          @for (year of yearsList(); track year) {
            <dcx-ng-button
              class="dcx-datepicker__day"
              [label]="year.toString()"
              (buttonClick)="selectYear(year)"
            >
            </dcx-ng-button>
          }
        </div>
      }
      <div class="dcx-datepicker__footer">
        <dcx-ng-button
          class="dcx-datepicker__today-btn"
          variant="secondary"
          iconStart="calendar"
          ariaLabel="Ir a hoy"
          (buttonClick)="goToToday()"
        >
          Hoy
        </dcx-ng-button>
      </div>
    </div>
  }
</div>
