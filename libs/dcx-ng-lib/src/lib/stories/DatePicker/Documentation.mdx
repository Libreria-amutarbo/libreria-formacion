import { Meta, Canvas } from '@storybook/blocks';
import * as DatePickerClassBasedStories from './ClassBased.stories';
import * as DatePickerUnstyledStories from './UnStyled.stories';

<Meta title="DCXLibrary/DatePicker/Documentation" />

# DatePicker

The `dcx-ng-date-picker` component is a customizable and accessible date selection field.
It uses Angular signals API for reactive state management and provides an interactive calendar popup for date selection.

---

## Class-Based Version

This version includes styling using CSS custom properties and BEM methodology.
It supports calendar popup, month navigation, date validation, and disabled states.

<Canvas of={DatePickerClassBasedStories.Default} />

---

### Usage Examples

The following stories demonstrate different use cases:

**With Min/Max Date Validation:**

<Canvas of={DatePickerClassBasedStories.WithMinAndMaxDate} />

**Disabled State:**

<Canvas of={DatePickerClassBasedStories.Disabled} />

---

### Available Properties

#### Inputs

- **selectedDate**: `Date | null` - Currently selected date
- **minDate**: `Date | null` - Minimum selectable date (dates before this will be disabled)
- **maxDate**: `Date | null` - Maximum selectable date (dates after this will be disabled)
- **disabled**: `boolean` - Disables the entire component
- **placeholder**: `string` - Placeholder text when no date is selected (default: 'Select date')

#### Outputs

- **dateChange**: `Date | null` - Emitted when a date is selected or cleared

---

## Calendar Features

The DatePicker includes a rich calendar interface:

- **42-day grid**: Displays 6 weeks for consistent layout
- **Week starts on Sunday**: Following Spanish locale convention
- **Month navigation**: Previous/Next buttons to navigate between months
- **Visual indicators**:
  - Today's date is highlighted
  - Selected date has distinct styling
  - Dates from other months appear grayed out
  - Disabled dates are crossed out and non-interactive
- **Clear button**: Optional button to reset selection (shown when date is selected)

---

## Signals API

This component uses Angular's modern signals API for optimal reactivity:

- `input()` for component inputs with automatic change detection
- `output()` for event emission
- `computed()` for derived values (calendar days, formatted dates, month name)
- `signal()` for internal state management (current month, popup visibility)
- `effect()` for synchronizing current month with selected date

---

## Usage Examples

### Basic Usage

```typescript
import { Component, signal } from '@angular/core';
import { DcxNgDatePickerComponent } from 'dcx-ng-lib';

@Component({
  selector: 'app-demo',
  standalone: true,
  imports: [DcxNgDatePickerComponent],
  template: `
    <dcx-ng-date-picker
      [selectedDate]="selectedDate()"
      (dateChange)="onDateChange($event)">
    </dcx-ng-date-picker>

    <p>Fecha seleccionada: {{ selectedDate() ? selectedDate()!.toLocaleDateString('es-ES') : 'ninguna' }}</p>
  `
})
export class DemoComponent {
  selectedDate = signal<Date | null>(null);

  onDateChange(date: Date | null): void {
    this.selectedDate.set(date);
    console.log('Nueva fecha:', date);
  }
}
```

### With Date Constraints

```typescript
@Component({
  selector: 'app-demo',
  standalone: true,
  imports: [DcxNgDatePickerComponent],
  template: `
    <dcx-ng-date-picker
      [selectedDate]="selectedDate()"
      [minDate]="minDate()"
      [maxDate]="maxDate()"
      [placeholder]="'Selecciona una fecha'"
      (dateChange)="onDateChange($event)">
    </dcx-ng-date-picker>
  `
})
export class DemoComponent {
  selectedDate = signal<Date | null>(new Date());
  minDate = signal(new Date(2024, 0, 1)); // 1 enero 2024
  maxDate = signal(new Date(2025, 11, 31)); // 31 diciembre 2025

  onDateChange(date: Date | null): void {
    this.selectedDate.set(date);
  }
}
```

### Disabled State

```typescript
@Component({
  selector: 'app-demo',
  standalone: true,
  imports: [DcxNgDatePickerComponent],
  template: `
    <dcx-ng-date-picker
      [selectedDate]="selectedDate()"
      [disabled]="isDisabled()"
      (dateChange)="onDateChange($event)">
    </dcx-ng-date-picker>

    <button (click)="toggleDisabled()">
      {{ isDisabled() ? 'Habilitar' : 'Deshabilitar' }}
    </button>
  `
})
export class DemoComponent {
  selectedDate = signal<Date | null>(null);
  isDisabled = signal(false);

  onDateChange(date: Date | null): void {
    this.selectedDate.set(date);
  }

  toggleDisabled(): void {
    this.isDisabled.update(v => !v);
  }
}
```

---

## Date Format

The component displays dates in Spanish format: **dd/mm/yyyy**

Example: `15/01/2025` for January 15, 2025

---

## Accessibility

- Semantic HTML structure with proper ARIA attributes
- Keyboard navigation support (Tab, Arrow keys, Enter, Esc)
- Clear visual feedback for interactive elements
- Disabled state properly communicated
- Focus management for popup interactions
- Screen reader friendly
