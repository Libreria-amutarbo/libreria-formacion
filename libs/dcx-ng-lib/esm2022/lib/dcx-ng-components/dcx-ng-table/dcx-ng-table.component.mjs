// eslint-disable-next-line @nx/enforce-module-boundaries
import { CommonModule } from '@angular/common';
import { Component, EventEmitter, Input, Output, signal, } from '@angular/core';
import * as i0 from "@angular/core";
import * as i1 from "@angular/common";
export var SortType;
(function (SortType) {
    SortType["Ascending"] = "ascending";
    SortType["Descending"] = "descending";
    SortType["None"] = "none";
})(SortType || (SortType = {}));
export class DcxNgTableComponent {
    headers;
    rows;
    showGrid = false;
    showStripped = false;
    scroll = false;
    scrollHeight = '320px';
    headerTemplate;
    cellTemplate;
    menuCellTemplate;
    sortChange = new EventEmitter();
    sort = signal({ key: null, dir: null });
    ngOnInit() {
        this.ensureRowIds();
    }
    sortedRows() {
        const _rows = [...this.rows];
        const { key, dir } = this.sort();
        if (!key || !dir)
            return _rows;
        const header = this.headers.find(h => h.key === key);
        const type = header?.type ?? this.inferType(_rows, key);
        _rows.sort((a, b) => this.compare(a?.[key], b?.[key], type));
        if (dir === 'desc')
            _rows.reverse();
        return _rows;
    }
    onHeaderClick(header) {
        if (!header.sortable)
            return;
        let nextDirection;
        if (this.sort().key !== header.key) {
            nextDirection = 'asc';
        }
        else {
            switch (this.sort().dir) {
                case 'asc':
                    nextDirection = 'desc';
                    break;
                case 'desc':
                    nextDirection = null;
                    break;
                default:
                    nextDirection = 'asc';
            }
        }
        this.sort.set({ key: header.key ?? null, dir: nextDirection });
        this.sortChange.emit(this.sort());
    }
    ariaSort(header) {
        const currentSort = this.sort();
        if (currentSort.key !== header.key || !currentSort.dir)
            return SortType.None;
        return currentSort.dir === 'asc' ? SortType.Ascending : SortType.Descending;
    }
    ensureRowIds() {
        this.rows.forEach((row, index) => {
            if (row.id === undefined || row.id === null) {
                row.id = index;
            }
        });
    }
    inferType(rows, key) {
        const first = rows.find(r => r?.[key] !== null && r?.[key] !== undefined)?.[key];
        return typeof first === 'number' ? 'number' : 'string';
    }
    compare(leftValue, rightValue, valueType) {
        const leftIsNull = leftValue === null || leftValue === undefined;
        const rightIsNull = rightValue === null || rightValue === undefined;
        if (leftIsNull && rightIsNull)
            return 0;
        if (leftIsNull)
            return 1;
        if (rightIsNull)
            return -1;
        if (valueType === 'number') {
            const leftNumber = Number(leftValue);
            const rightNumber = Number(rightValue);
            const leftIsNaN = Number.isNaN(leftNumber);
            const rightIsNaN = Number.isNaN(rightNumber);
            if (leftIsNaN && rightIsNaN)
                return 0;
            if (leftIsNaN)
                return 1;
            if (rightIsNaN)
                return -1;
            if (leftNumber === rightNumber)
                return 0;
            return leftNumber < rightNumber ? -1 : 1;
        }
        const leftText = String(leftValue);
        const rightText = String(rightValue);
        return leftText.localeCompare(rightText, undefined, {
            sensitivity: 'base',
            numeric: true,
        });
    }
    static ɵfac = i0.ɵɵngDeclareFactory({ minVersion: "12.0.0", version: "18.2.14", ngImport: i0, type: DcxNgTableComponent, deps: [], target: i0.ɵɵFactoryTarget.Component });
    static ɵcmp = i0.ɵɵngDeclareComponent({ minVersion: "17.0.0", version: "18.2.14", type: DcxNgTableComponent, isStandalone: true, selector: "dcx-ng-table", inputs: { headers: "headers", rows: "rows", showGrid: "showGrid", showStripped: "showStripped", scroll: "scroll", scrollHeight: "scrollHeight", headerTemplate: "headerTemplate", cellTemplate: "cellTemplate", menuCellTemplate: "menuCellTemplate" }, outputs: { sortChange: "sortChange" }, ngImport: i0, template: "<div\r\n  class=\"table-wrapper\"\r\n  [class.scroll]=\"scroll\"\r\n  [style.max-height]=\"scroll ? scrollHeight : null\"\r\n>\r\n  <table [class.grid]=\"showGrid\" [class.striped]=\"showStripped\">\r\n    <thead>\r\n      <tr>\r\n        @for (header of headers; track header.key) {\r\n          <th\r\n            scope=\"col\"\r\n            (click)=\"onHeaderClick(header)\"\r\n            (keydown.enter)=\"onHeaderClick(header)\"\r\n            (keydown.space)=\"onHeaderClick(header); $event.preventDefault()\"\r\n            [class.sortable]=\"header.sortable\"\r\n            [attr.aria-sort]=\"ariaSort(header)\"\r\n            [attr.tabindex]=\"header.sortable ? 0 : null\"\r\n          >\r\n            <ng-container\r\n              *ngTemplateOutlet=\"headerTemplate || defaultHeaderTpl; context: { $implicit: header }\"\r\n            ></ng-container>\r\n          </th>\r\n        }\r\n\r\n        <th class=\"menu-col\" scope=\"col\"></th>\r\n      </tr>\r\n    </thead>\r\n\r\n    <tbody>\r\n      @if (sortedRows().length === 0) {\r\n        <tr>\r\n          <td [attr.colspan]=\"headers.length + 1\" class=\"empty-cell\">\r\n            No hay datos\r\n          </td>\r\n        </tr>\r\n      } @else {\r\n        @for (row of sortedRows(); track row.id) {\r\n          <tr class=\"table-row\">\r\n            @for (header of headers; track header.key) {\r\n              <td>\r\n                <ng-container\r\n                  *ngTemplateOutlet=\"cellTemplate || defaultCellTpl; context: { $implicit: row, key: header.key }\"\r\n                ></ng-container>\r\n              </td>\r\n            }\r\n            <td class=\"menu-col\">\r\n              <ng-container\r\n                *ngTemplateOutlet=\"menuCellTemplate || defaultMenuCellTpl; context: { $implicit: row, index: $index }\"\r\n              ></ng-container>\r\n            </td>\r\n          </tr>\r\n        }\r\n      }\r\n    </tbody>\r\n  </table>\r\n</div>\r\n\r\n<ng-template #defaultHeaderTpl let-header>\r\n  <strong>{{ header.name }}</strong>\r\n  @if (header.sortable) {\r\n    <span class=\"sort-indicator\" aria-hidden=\"true\">\r\n      @if (ariaSort(header) === 'ascending') {\r\n        \u25B2\r\n      } @else if (ariaSort(header) === 'descending') {\r\n        \u25BC\r\n      } @else {\r\n        \u2195\r\n      }\r\n    </span>\r\n  }\r\n</ng-template>\r\n\r\n<ng-template #defaultCellTpl let-row let-key=\"key\">\r\n  {{ row?.[key] }}\r\n</ng-template>\r\n\r\n<ng-template #defaultMenuCellTpl>\r\n  <button\r\n    type=\"button\"\r\n    class=\"btn icon\"\r\n    title=\"Context menu (TODO)\"\r\n    disabled\r\n    aria-disabled=\"true\"\r\n  >\r\n    \u22EE\r\n  </button>\r\n</ng-template>\r\n", styles: [".table-wrapper{width:100%;overflow:hidden}.table-wrapper.scroll{overflow:auto}table{width:100%;border-collapse:collapse}table.grid td,table.grid th{border:1px solid var(--table-border, #e3e3e3)}table.striped tbody tr:nth-child(odd){background:var(--table-striped, #fafafa)}thead th{position:sticky;top:0;z-index:1;background:var(--surface, #fff);text-align:left;padding:.5rem .75rem;font-weight:700;line-height:1.2;border-bottom:2px solid var(--table-divider, #e3e3e3)}thead th.sortable{cursor:pointer}tbody td{padding:.5rem .75rem;vertical-align:top}.table-row:hover{background:var(--table-row-hover, #f6f6f6)}.menu-col{white-space:nowrap;text-align:right;width:.1%}.sort-indicator{margin-left:.375rem;opacity:.7}.btn.icon{background:none;border:none;color:#555;cursor:not-allowed;padding:0 .25rem;font:inherit}.empty-cell{text-align:center;color:#777;padding:1rem}\n"], dependencies: [{ kind: "ngmodule", type: CommonModule }, { kind: "directive", type: i1.NgTemplateOutlet, selector: "[ngTemplateOutlet]", inputs: ["ngTemplateOutletContext", "ngTemplateOutlet", "ngTemplateOutletInjector"] }] });
}
i0.ɵɵngDeclareClassMetadata({ minVersion: "12.0.0", version: "18.2.14", ngImport: i0, type: DcxNgTableComponent, decorators: [{
            type: Component,
            args: [{ selector: 'dcx-ng-table', standalone: true, imports: [CommonModule], template: "<div\r\n  class=\"table-wrapper\"\r\n  [class.scroll]=\"scroll\"\r\n  [style.max-height]=\"scroll ? scrollHeight : null\"\r\n>\r\n  <table [class.grid]=\"showGrid\" [class.striped]=\"showStripped\">\r\n    <thead>\r\n      <tr>\r\n        @for (header of headers; track header.key) {\r\n          <th\r\n            scope=\"col\"\r\n            (click)=\"onHeaderClick(header)\"\r\n            (keydown.enter)=\"onHeaderClick(header)\"\r\n            (keydown.space)=\"onHeaderClick(header); $event.preventDefault()\"\r\n            [class.sortable]=\"header.sortable\"\r\n            [attr.aria-sort]=\"ariaSort(header)\"\r\n            [attr.tabindex]=\"header.sortable ? 0 : null\"\r\n          >\r\n            <ng-container\r\n              *ngTemplateOutlet=\"headerTemplate || defaultHeaderTpl; context: { $implicit: header }\"\r\n            ></ng-container>\r\n          </th>\r\n        }\r\n\r\n        <th class=\"menu-col\" scope=\"col\"></th>\r\n      </tr>\r\n    </thead>\r\n\r\n    <tbody>\r\n      @if (sortedRows().length === 0) {\r\n        <tr>\r\n          <td [attr.colspan]=\"headers.length + 1\" class=\"empty-cell\">\r\n            No hay datos\r\n          </td>\r\n        </tr>\r\n      } @else {\r\n        @for (row of sortedRows(); track row.id) {\r\n          <tr class=\"table-row\">\r\n            @for (header of headers; track header.key) {\r\n              <td>\r\n                <ng-container\r\n                  *ngTemplateOutlet=\"cellTemplate || defaultCellTpl; context: { $implicit: row, key: header.key }\"\r\n                ></ng-container>\r\n              </td>\r\n            }\r\n            <td class=\"menu-col\">\r\n              <ng-container\r\n                *ngTemplateOutlet=\"menuCellTemplate || defaultMenuCellTpl; context: { $implicit: row, index: $index }\"\r\n              ></ng-container>\r\n            </td>\r\n          </tr>\r\n        }\r\n      }\r\n    </tbody>\r\n  </table>\r\n</div>\r\n\r\n<ng-template #defaultHeaderTpl let-header>\r\n  <strong>{{ header.name }}</strong>\r\n  @if (header.sortable) {\r\n    <span class=\"sort-indicator\" aria-hidden=\"true\">\r\n      @if (ariaSort(header) === 'ascending') {\r\n        \u25B2\r\n      } @else if (ariaSort(header) === 'descending') {\r\n        \u25BC\r\n      } @else {\r\n        \u2195\r\n      }\r\n    </span>\r\n  }\r\n</ng-template>\r\n\r\n<ng-template #defaultCellTpl let-row let-key=\"key\">\r\n  {{ row?.[key] }}\r\n</ng-template>\r\n\r\n<ng-template #defaultMenuCellTpl>\r\n  <button\r\n    type=\"button\"\r\n    class=\"btn icon\"\r\n    title=\"Context menu (TODO)\"\r\n    disabled\r\n    aria-disabled=\"true\"\r\n  >\r\n    \u22EE\r\n  </button>\r\n</ng-template>\r\n", styles: [".table-wrapper{width:100%;overflow:hidden}.table-wrapper.scroll{overflow:auto}table{width:100%;border-collapse:collapse}table.grid td,table.grid th{border:1px solid var(--table-border, #e3e3e3)}table.striped tbody tr:nth-child(odd){background:var(--table-striped, #fafafa)}thead th{position:sticky;top:0;z-index:1;background:var(--surface, #fff);text-align:left;padding:.5rem .75rem;font-weight:700;line-height:1.2;border-bottom:2px solid var(--table-divider, #e3e3e3)}thead th.sortable{cursor:pointer}tbody td{padding:.5rem .75rem;vertical-align:top}.table-row:hover{background:var(--table-row-hover, #f6f6f6)}.menu-col{white-space:nowrap;text-align:right;width:.1%}.sort-indicator{margin-left:.375rem;opacity:.7}.btn.icon{background:none;border:none;color:#555;cursor:not-allowed;padding:0 .25rem;font:inherit}.empty-cell{text-align:center;color:#777;padding:1rem}\n"] }]
        }], propDecorators: { headers: [{
                type: Input,
                args: [{ required: true }]
            }], rows: [{
                type: Input,
                args: [{ required: true }]
            }], showGrid: [{
                type: Input
            }], showStripped: [{
                type: Input
            }], scroll: [{
                type: Input
            }], scrollHeight: [{
                type: Input
            }], headerTemplate: [{
                type: Input
            }], cellTemplate: [{
                type: Input
            }], menuCellTemplate: [{
                type: Input
            }], sortChange: [{
                type: Output
            }] } });
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZGN4LW5nLXRhYmxlLmNvbXBvbmVudC5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uLy4uLy4uLy4uL2xpYnMvZGN4LW5nLWxpYi9zcmMvbGliL2RjeC1uZy1jb21wb25lbnRzL2RjeC1uZy10YWJsZS9kY3gtbmctdGFibGUuY29tcG9uZW50LnRzIiwiLi4vLi4vLi4vLi4vLi4vLi4vLi4vbGlicy9kY3gtbmctbGliL3NyYy9saWIvZGN4LW5nLWNvbXBvbmVudHMvZGN4LW5nLXRhYmxlL2RjeC1uZy10YWJsZS5jb21wb25lbnQuaHRtbCJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSx5REFBeUQ7QUFDekQsT0FBTyxFQUFFLFlBQVksRUFBRSxNQUFNLGlCQUFpQixDQUFDO0FBQy9DLE9BQU8sRUFDTCxTQUFTLEVBQ1QsWUFBWSxFQUNaLEtBQUssRUFFTCxNQUFNLEVBQ04sTUFBTSxHQUVQLE1BQU0sZUFBZSxDQUFDOzs7QUFJdkIsTUFBTSxDQUFOLElBQVksUUFJWDtBQUpELFdBQVksUUFBUTtJQUNsQixtQ0FBdUIsQ0FBQTtJQUN2QixxQ0FBeUIsQ0FBQTtJQUN6Qix5QkFBYSxDQUFBO0FBQ2YsQ0FBQyxFQUpXLFFBQVEsS0FBUixRQUFRLFFBSW5CO0FBc0JELE1BQU0sT0FBTyxtQkFBbUI7SUFDSCxPQUFPLENBQWdCO0lBQ3ZCLElBQUksQ0FBUztJQUUvQixRQUFRLEdBQUcsS0FBSyxDQUFDO0lBQ2pCLFlBQVksR0FBRyxLQUFLLENBQUM7SUFDckIsTUFBTSxHQUFHLEtBQUssQ0FBQztJQUNmLFlBQVksR0FBRyxPQUFPLENBQUM7SUFFdkIsY0FBYyxDQUFvQjtJQUNsQyxZQUFZLENBQW9CO0lBQ2hDLGdCQUFnQixDQUFvQjtJQUVuQyxVQUFVLEdBQUcsSUFBSSxZQUFZLEVBQVEsQ0FBQztJQUVoRCxJQUFJLEdBQUcsTUFBTSxDQUFPLEVBQUUsR0FBRyxFQUFFLElBQUksRUFBRSxHQUFHLEVBQUUsSUFBSSxFQUFFLENBQUMs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VUFBVTtnQkFBRSxPQUFPLENBQUMsQ0FBQyxDQUFDO1lBRTFCLElBQUksVUFBVSxLQUFLLFdBQVc7Z0JBQUUsT0FBTyxDQUFDLENBQUM7WUFDekMsT0FBTyxVQUFVLEdBQUcsV0FBVyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDO1FBQzNDLENBQUM7UUFFRCxNQUFNLFFBQVEsR0FBRyxNQUFNLENBQUMsU0FBUyxDQUFDLENBQUM7UUFDbkMsTUFBTSxTQUFTLEdBQUcsTUFBTSxDQUFDLFVBQVUsQ0FBQyxDQUFDO1FBRXJDLE9BQU8sUUFBUSxDQUFDLGFBQWEsQ0FBQyxTQUFTLEVBQUUsU0FBUyxFQUFFO1lBQ2xELFdBQVcsRUFBRSxNQUFNO1lBQ25CLE9BQU8sRUFBRSxJQUFJO1NBQ2QsQ0FBQyxDQUFDO0lBQ0wsQ0FBQzt3R0FsSFUsbUJBQW1COzRGQUFuQixtQkFBbUIsdVdDeENoQyw4cEZBdUZBLDY1QkRuRFksWUFBWTs7NEZBSVgsbUJBQW1CO2tCQVAvQixTQUFTOytCQUNFLGNBQWMsY0FDWixJQUFJLFdBQ1AsQ0FBQyxZQUFZLENBQUM7OEJBS0ksT0FBTztzQkFBakMsS0FBSzt1QkFBQyxFQUFFLFFBQVEsRUFBRSxJQUFJLEVBQUU7Z0JBQ0UsSUFBSTtzQkFBOUIsS0FBSzt1QkFBQyxFQUFFLFFBQVEsRUFBRSxJQUFJLEVBQUU7Z0JBRWhCLFFBQVE7c0JBQWhCLEtBQUs7Z0JBQ0csWUFBWTtzQkFBcEIsS0FBSztnQkFDRyxNQUFNO3NCQUFkLEtBQUs7Z0JBQ0csWUFBWTtzQkFBcEIsS0FBSztnQkFFRyxjQUFjO3NCQUF0QixLQUFLO2dCQUNHLFlBQVk7c0JBQXBCLEtBQUs7Z0JBQ0csZ0JBQWdCO3NCQUF4QixLQUFLO2dCQUVJLFVBQVU7c0JBQW5CLE1BQU0iLCJzb3VyY2VzQ29udGVudCI6WyIvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgQG54L2VuZm9yY2UtbW9kdWxlLWJvdW5kYXJpZXNcclxuaW1wb3J0IHsgQ29tbW9uTW9kdWxlIH0gZnJvbSAnQGFuZ3VsYXIvY29tbW9uJztcclxuaW1wb3J0IHtcclxuICBDb21wb25lbnQsXHJcbiAgRXZlbnRFbWl0dGVyLFxyXG4gIElucHV0LFxyXG4gIE9uSW5pdCxcclxuICBPdXRwdXQsXHJcbiAgc2lnbmFsLFxyXG4gIFRlbXBsYXRlUmVmLFxyXG59IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xyXG5cclxudHlwZSBTb3J0RGlyZWN0aW9uID0gJ2FzYycgfCAnZGVzYycgfCBudWxsO1xyXG5cclxuZXhwb3J0IGVudW0gU29ydFR5cGUge1xyXG4gIEFzY2VuZGluZyA9ICdhc2NlbmRpbmcnLFxyXG4gIERlc2NlbmRpbmcgPSAnZGVzY2VuZGluZycsXHJcbiAgTm9uZSA9ICdub25lJyxcclxufVxyXG5cclxuZXhwb3J0IGludGVyZmFjZSBIZWFkZXJEYXRhIHtcclxuICBuYW1lOiBzdHJpbmc7XHJcbiAga2V5Pzogc3RyaW5nO1xyXG4gIHNvcnRhYmxlPzogYm9vbGVhbjtcclxuICB0eXBlPzogJ3N0cmluZycgfCAnbnVtYmVyJztcclxuICBkZWZhdWx0U29ydD86IEV4Y2x1ZGU8U29ydERpcmVjdGlvbiwgbnVsbD47XHJcbn1cclxuXHJcbmludGVyZmFjZSBTb3J0IHtcclxuICBrZXk6IHN0cmluZyB8IG51bGw7XHJcbiAgZGlyOiBTb3J0RGlyZWN0aW9uO1xyXG59XHJcblxyXG5AQ29tcG9uZW50KHtcclxuICBzZWxlY3RvcjogJ2RjeC1uZy10YWJsZScsXHJcbiAgc3RhbmRhbG9uZTogdHJ1ZSxcclxuICBpbXBvcnRzOiBbQ29tbW9uTW9kdWxlXSxcclxuICB0ZW1wbGF0ZVVybDogJy4vZGN4LW5nLXRhYmxlLmNvbXBvbmVudC5odG1sJyxcclxuICBzdHlsZVVybHM6IFsnLi9kY3gtbmctdGFibGUuY29tcG9uZW50LnNjc3MnXSxcclxufSlcclxuZXhwb3J0IGNsYXNzIERjeE5nVGFibGVDb21wb25lbnQgaW1wbGVtZW50cyBPbkluaXQge1xyXG4gIEBJbnB1dCh7IHJlcXVpcmVkOiB0cnVlIH0pIGhlYWRlcnMhOiBIZWFkZXJEYXRhW107XHJcbiAgQElucHV0KHsgcmVxdWlyZWQ6IHRydWUgfSkgcm93cyE6IGFueVtdO1xyXG5cclxuICBASW5wdXQoKSBzaG93R3JpZCA9IGZhbHNlO1xyXG4gIEBJbnB1dCgpIHNob3dTdHJpcHBlZCA9IGZhbHNlO1xyXG4gIEBJbnB1dCgpIHNjcm9sbCA9IGZhbHNlO1xyXG4gIEBJbnB1dCgpIHNjcm9sbEhlaWdodCA9ICczMjBweCc7XHJcblxyXG4gIEBJbnB1dCgpIGhlYWRlclRlbXBsYXRlPzogVGVtcGxhdGVSZWY8YW55PjtcclxuICBASW5wdXQoKSBjZWxsVGVtcGxhdGU/OiBUZW1wbGF0ZVJlZjxhbnk+O1xyXG4gIEBJbnB1dCgpIG1lbnVDZWxsVGVtcGxhdGU/OiBUZW1wbGF0ZVJlZjxhbnk+O1xyXG5cclxuICBAT3V0cHV0KCkgc29ydENoYW5nZSA9IG5ldyBFdmVudEVtaXR0ZXI8U29ydD4oKTtcclxuXHJcbiAgc29ydCA9IHNpZ25hbDxTb3J0Pih7IGtleTogbnVsbCwgZGlyOiBudWxsIH0pO1xyXG5cclxuICBuZ09uSW5pdCgpOiB2b2lkIHtcclxuICAgIHRoaXMuZW5zdXJlUm93SWRzKCk7XHJcbiAgfVxyXG5cclxuICBzb3J0ZWRSb3dzKCk6IGFueVtdIHtcclxuICAgIGNvbnN0IF9yb3dzID0gWy4uLnRoaXMucm93c107XHJcbiAgICBjb25zdCB7IGtleSwgZGlyIH0gPSB0aGlzLnNvcnQoKTtcclxuICAgIGlmICgha2V5IHx8ICFkaXIpIHJldHVybiBfcm93cztcclxuXHJcbiAgICBjb25zdCBoZWFkZXIgPSB0aGlzLmhlYWRlcnMuZmluZChoID0+IGgua2V5ID09PSBrZXkpO1xyXG4gICAgY29uc3QgdHlwZSA9IGhlYWRlcj8udHlwZSA/PyB0aGlzLmluZmVyVHlwZShfcm93cywga2V5KTtcclxuXHJcbiAgICBfcm93cy5zb3J0KChhLCBiKSA9PiB0aGlzLmNvbXBhcmUoYT8uW2tleV0sIGI/LltrZXldLCB0eXBlKSk7XHJcbiAgICBpZiAoZGlyID09PSAnZGVzYycpIF9yb3dzLnJldmVyc2UoKTtcclxuXHJcbiAgICByZXR1cm4gX3Jvd3M7XHJcbiAgfVxyXG5cclxuICBvbkhlYWRlckNsaWNrKGhlYWRlcjogSGVhZGVyRGF0YSkge1xyXG4gICAgaWYgKCFoZWFkZXIuc29ydGFibGUpIHJldHVybjtcclxuXHJcbiAgICBsZXQgbmV4dERpcmVjdGlvbjogU29ydERpcmVjdGlvbjtcclxuXHJcbiAgICBpZiAodGhpcy5zb3J0KCkua2V5ICE9PSBoZWFkZXIua2V5KSB7XHJcbiAgICAgIG5leHREaXJlY3Rpb24gPSAnYXNjJztcclxuICAgIH0gZWxzZSB7XHJcbiAgICAgIHN3aXRjaCAodGhpcy5zb3J0KCkuZGlyKSB7XHJcbiAgICAgICAgY2FzZSAnYXNjJzpcclxuICAgICAgICAgIG5leHREaXJlY3Rpb24gPSAnZGVzYyc7XHJcbiAgICAgICAgICBicmVhaztcclxuICAgICAgICBjYXNlICdkZXNjJzpcclxuICAgICAgICAgIG5leHREaXJlY3Rpb24gPSBudWxsO1xyXG4gICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgZGVmYXVsdDpcclxuICAgICAgICAgIG5leHREaXJlY3Rpb24gPSAnYXNjJztcclxuICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIHRoaXMuc29ydC5zZXQoeyBrZXk6IGhlYWRlci5rZXkgPz8gbnVsbCwgZGlyOiBuZXh0RGlyZWN0aW9uIH0pO1xyXG4gICAgdGhpcy5zb3J0Q2hhbmdlLmVtaXQodGhpcy5zb3J0KCkpO1xyXG4gIH1cclxuXHJcbiAgYXJpYVNvcnQoaGVhZGVyOiBIZWFkZXJEYXRhKTogU29ydFR5cGUge1xyXG4gICAgY29uc3QgY3VycmVudFNvcnQgPSB0aGlzLnNvcnQoKTtcclxuICAgIGlmIChjdXJyZW50U29ydC5rZXkgIT09IGhlYWRlci5rZXkgfHwgIWN1cnJlbnRTb3J0LmRpcilcclxuICAgICAgcmV0dXJuIFNvcnRUeXBlLk5vbmU7XHJcbiAgICByZXR1cm4gY3VycmVudFNvcnQuZGlyID09PSAnYXNjJyA/IFNvcnRUeXBlLkFzY2VuZGluZyA6IFNvcnRUeXBlLkRlc2NlbmRpbmc7XHJcbiAgfVxyXG5cclxuICBwcml2YXRlIGVuc3VyZVJvd0lkcygpOiB2b2lkIHtcclxuICAgIHRoaXMucm93cy5mb3JFYWNoKChyb3csIGluZGV4KSA9PiB7XHJcbiAgICAgIGlmIChyb3cuaWQgPT09IHVuZGVmaW5lZCB8fCByb3cuaWQgPT09IG51bGwpIHtcclxuICAgICAgICByb3cuaWQgPSBpbmRleDtcclxuICAgICAgfVxyXG4gICAgfSk7XHJcbiAgfVxyXG5cclxuICBwcml2YXRlIGluZmVyVHlwZShyb3dzOiBhbnlbXSwga2V5OiBzdHJpbmcpOiAnbnVtYmVyJyB8ICdzdHJpbmcnIHtcclxuICAgIGNvbnN0IGZpcnN0ID0gcm93cy5maW5kKHIgPT4gcj8uW2tleV0gIT09IG51bGwgJiYgcj8uW2tleV0gIT09IHVuZGVmaW5lZCk/LltcclxuICAgICAga2V5XHJcbiAgICBdO1xyXG4gICAgcmV0dXJuIHR5cGVvZiBmaXJzdCA9PT0gJ251bWJlcicgPyAnbnVtYmVyJyA6ICdzdHJpbmcnO1xyXG4gIH1cclxuXHJcbiAgcHJpdmF0ZSBjb21wYXJlKFxyXG4gICAgbGVmdFZhbHVlOiBhbnksXHJcbiAgICByaWdodFZhbHVlOiBhbnksXHJcbiAgICB2YWx1ZVR5cGU6ICdzdHJpbmcnIHwgJ251bWJlcicsXHJcbiAgKTogbnVtYmVyIHtcclxuICAgIGNvbnN0IGxlZnRJc051bGwgPSBsZWZ0VmFsdWUgPT09IG51bGwgfHwgbGVmdFZhbHVlID09PSB1bmRlZmluZWQ7XHJcbiAgICBjb25zdCByaWdodElzTnVsbCA9IHJpZ2h0VmFsdWUgPT09IG51bGwgfHwgcmlnaHRWYWx1ZSA9PT0gdW5kZWZpbmVkO1xyXG5cclxuICAgIGlmIChsZWZ0SXNOdWxsICYmIHJpZ2h0SXNOdWxsKSByZXR1cm4gMDtcclxuICAgIGlmIChsZWZ0SXNOdWxsKSByZXR1cm4gMTtcclxuICAgIGlmIChyaWdodElzTnVsbCkgcmV0dXJuIC0xO1xyXG5cclxuICAgIGlmICh2YWx1ZVR5cGUgPT09ICdudW1iZXInKSB7XHJcbiAgICAgIGNvbnN0IGxlZnROdW1iZXIgPSBOdW1iZXIobGVmdFZhbHVlKTtcclxuICAgICAgY29uc3QgcmlnaHROdW1iZXIgPSBOdW1iZXIocmlnaHRWYWx1ZSk7XHJcbiAgICAgIGNvbnN0IGxlZnRJc05hTiA9IE51bWJlci5pc05hTihsZWZ0TnVtYmVyKTtcclxuICAgICAgY29uc3QgcmlnaHRJc05hTiA9IE51bWJlci5pc05hTihyaWdodE51bWJlcik7XHJcblxyXG4gICAgICBpZiAobGVmdElzTmFOICYmIHJpZ2h0SXNOYU4pIHJldHVybiAwO1xyXG4gICAgICBpZiAobGVmdElzTmFOKSByZXR1cm4gMTtcclxuICAgICAgaWYgKHJpZ2h0SXNOYU4pIHJldHVybiAtMTtcclxuXHJcbiAgICAgIGlmIChsZWZ0TnVtYmVyID09PSByaWdodE51bWJlcikgcmV0dXJuIDA7XHJcbiAgICAgIHJldHVybiBsZWZ0TnVtYmVyIDwgcmlnaHROdW1iZXIgPyAtMSA6IDE7XHJcbiAgICB9XHJcblxyXG4gICAgY29uc3QgbGVmdFRleHQgPSBTdHJpbmcobGVmdFZhbHVlKTtcclxuICAgIGNvbnN0IHJpZ2h0VGV4dCA9IFN0cmluZyhyaWdodFZhbHVlKTtcclxuXHJcbiAgICByZXR1cm4gbGVmdFRleHQubG9jYWxlQ29tcGFyZShyaWdodFRleHQsIHVuZGVmaW5lZCwge1xyXG4gICAgICBzZW5zaXRpdml0eTogJ2Jhc2UnLFxyXG4gICAgICBudW1lcmljOiB0cnVlLFxyXG4gICAgfSk7XHJcbiAgfVxyXG59XHJcbiIsIjxkaXZcclxuICBjbGFzcz1cInRhYmxlLXdyYXBwZXJcIlxyXG4gIFtjbGFzcy5zY3JvbGxdPVwic2Nyb2xsXCJcclxuICBbc3R5bGUubWF4LWhlaWdodF09XCJzY3JvbGwgPyBzY3JvbGxIZWlnaHQgOiBudWxsXCJcclxuPlxyXG4gIDx0YWJsZSBbY2xhc3MuZ3JpZF09XCJzaG93R3JpZFwiIFtjbGFzcy5zdHJpcGVkXT1cInNob3dTdHJpcHBlZFwiPlxyXG4gICAgPHRoZWFkPlxyXG4gICAgICA8dHI+XHJcbiAgICAgICAgQGZvciAoaGVhZGVyIG9mIGhlYWRlcnM7IHRyYWNrIGhlYWRlci5rZXkpIHtcclxuICAgICAgICAgIDx0aFxyXG4gICAgICAgICAgICBzY29wZT1cImNvbFwiXHJcbiAgICAgICAgICAgIChjbGljayk9XCJvbkhlYWRlckNsaWNrKGhlYWRlcilcIlxyXG4gICAgICAgICAgICAoa2V5ZG93bi5lbnRlcik9XCJvbkhlYWRlckNsaWNrKGhlYWRlcilcIlxyXG4gICAgICAgICAgICAoa2V5ZG93bi5zcGFjZSk9XCJvbkhlYWRlckNsaWNrKGhlYWRlcik7ICRldmVudC5wcmV2ZW50RGVmYXVsdCgpXCJcclxuICAgICAgICAgICAgW2NsYXNzLnNvcnRhYmxlXT1cImhlYWRlci5zb3J0YWJsZVwiXHJcbiAgICAgICAgICAgIFthdHRyLmFyaWEtc29ydF09XCJhcmlhU29ydChoZWFkZXIpXCJcclxuICAgICAgICAgICAgW2F0dHIudGFiaW5kZXhdPVwiaGVhZGVyLnNvcnRhYmxlID8gMCA6IG51bGxcIlxyXG4gICAgICAgICAgPlxyXG4gICAgICAgICAgICA8bmctY29udGFpbmVyXHJcbiAgICAgICAgICAgICAgKm5nVGVtcGxhdGVPdXRsZXQ9XCJoZWFkZXJUZW1wbGF0ZSB8fCBkZWZhdWx0SGVhZGVyVHBsOyBjb250ZXh0OiB7ICRpbXBsaWNpdDogaGVhZGVyIH1cIlxyXG4gICAgICAgICAgICA+PC9uZy1jb250YWluZXI+XHJcbiAgICAgICAgICA8L3RoPlxyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgPHRoIGNsYXNzPVwibWVudS1jb2xcIiBzY29wZT1cImNvbFwiPjwvdGg+XHJcbiAgICAgIDwvdHI+XHJcbiAgICA8L3RoZWFkPlxyXG5cclxuICAgIDx0Ym9keT5cclxuICAgICAgQGlmIChzb3J0ZWRSb3dzKCkubGVuZ3RoID09PSAwKSB7XHJcbiAgICAgICAgPHRyPlxyXG4gICAgICAgICAgPHRkIFthdHRyLmNvbHNwYW5dPVwiaGVhZGVycy5sZW5ndGggKyAxXCIgY2xhc3M9XCJlbXB0eS1jZWxsXCI+XHJcbiAgICAgICAgICAgIE5vIGhheSBkYXRvc1xyXG4gICAgICAgICAgPC90ZD5cclxuICAgICAgICA8L3RyPlxyXG4gICAgICB9IEBlbHNlIHtcclxuICAgICAgICBAZm9yIChyb3cgb2Ygc29ydGVkUm93cygpOyB0cmFjayByb3cuaWQpIHtcclxuICAgICAgICAgIDx0ciBjbGFzcz1cInRhYmxlLXJvd1wiPlxyXG4gICAgICAgICAgICBAZm9yIChoZWFkZXIgb2YgaGVhZGVyczsgdHJhY2sgaGVhZGVyLmtleSkge1xyXG4gICAgICAgICAgICAgIDx0ZD5cclxuICAgICAgICAgICAgICAgIDxuZy1jb250YWluZXJcclxuICAgICAgICAgICAgICAgICAgKm5nVGVtcGxhdGVPdXRsZXQ9XCJjZWxsVGVtcGxhdGUgfHwgZGVmYXVsdENlbGxUcGw7IGNvbnRleHQ6IHsgJGltcGxpY2l0OiByb3csIGtleTogaGVhZGVyLmtleSB9XCJcclxuICAgICAgICAgICAgICAgID48L25nLWNvbnRhaW5lcj5cclxuICAgICAgICAgICAgICA8L3RkPlxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIDx0ZCBjbGFzcz1cIm1lbnUtY29sXCI+XHJcbiAgICAgICAgICAgICAgPG5nLWNvbnRhaW5lclxyXG4gICAgICAgICAgICAgICAgKm5nVGVtcGxhdGVPdXRsZXQ9XCJtZW51Q2VsbFRlbXBsYXRlIHx8IGRlZmF1bHRNZW51Q2VsbFRwbDsgY29udGV4dDogeyAkaW1wbGljaXQ6IHJvdywgaW5kZXg6ICRpbmRleCB9XCJcclxuICAgICAgICAgICAgICA+PC9uZy1jb250YWluZXI+XHJcbiAgICAgICAgICAgIDwvdGQ+XHJcbiAgICAgICAgICA8L3RyPlxyXG4gICAgICAgIH1cclxuICAgICAgfVxyXG4gICAgPC90Ym9keT5cclxuICA8L3RhYmxlPlxyXG48L2Rpdj5cclxuXHJcbjxuZy10ZW1wbGF0ZSAjZGVmYXVsdEhlYWRlclRwbCBsZXQtaGVhZGVyPlxyXG4gIDxzdHJvbmc+e3sgaGVhZGVyLm5hbWUgfX08L3N0cm9uZz5cclxuICBAaWYgKGhlYWRlci5zb3J0YWJsZSkge1xyXG4gICAgPHNwYW4gY2xhc3M9XCJzb3J0LWluZGljYXRvclwiIGFyaWEtaGlkZGVuPVwidHJ1ZVwiPlxyXG4gICAgICBAaWYgKGFyaWFTb3J0KGhlYWRlcikgPT09ICdhc2NlbmRpbmcnKSB7XHJcbiAgICAgICAg4payXHJcbiAgICAgIH0gQGVsc2UgaWYgKGFyaWFTb3J0KGhlYWRlcikgPT09ICdkZXNjZW5kaW5nJykge1xyXG4gICAgICAgIOKWvFxyXG4gICAgICB9IEBlbHNlIHtcclxuICAgICAgICDihpVcclxuICAgICAgfVxyXG4gICAgPC9zcGFuPlxyXG4gIH1cclxuPC9uZy10ZW1wbGF0ZT5cclxuXHJcbjxuZy10ZW1wbGF0ZSAjZGVmYXVsdENlbGxUcGwgbGV0LXJvdyBsZXQta2V5PVwia2V5XCI+XHJcbiAge3sgcm93Py5ba2V5XSB9fVxyXG48L25nLXRlbXBsYXRlPlxyXG5cclxuPG5nLXRlbXBsYXRlICNkZWZhdWx0TWVudUNlbGxUcGw+XHJcbiAgPGJ1dHRvblxyXG4gICAgdHlwZT1cImJ1dHRvblwiXHJcbiAgICBjbGFzcz1cImJ0biBpY29uXCJcclxuICAgIHRpdGxlPVwiQ29udGV4dCBtZW51IChUT0RPKVwiXHJcbiAgICBkaXNhYmxlZFxyXG4gICAgYXJpYS1kaXNhYmxlZD1cInRydWVcIlxyXG4gID5cclxuICAgIOKLrlxyXG4gIDwvYnV0dG9uPlxyXG48L25nLXRlbXBsYXRlPlxyXG4iXX0=